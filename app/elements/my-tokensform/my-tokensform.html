<dom-module id="my-tokensform">
    <template>
        <style>
            :host {
                display: inline-block;
            }
        </style>
        <template is="dom-if" if="{{visible}}">
            <div id="input-container">
                <p id="name" name$="{{data.name}}">Componente {{getName}}</p>
                <template id="bucle_attr" is="dom-repeat" items="{{getAttr}}">
                    <label for="text">Atributo {{item.name}}</label>
                    <input id="text" type="text" on-change="_miFunction" />
                    <br>
                </template>
                <br>
                <paper-button raised class="custom indigo" id="button_analize" on-click="_analize">
                    Enviar y analizar
                </paper-button>
            </div>
        </template>

        <iron-ajax id="send_attr" method="post" url="/api/componentes" handle-as="json" on-response="handleResponse" body={{prop_object}}
            content-type="application/json"></iron-ajax>

    </template>
    <script>
        Polymer({
            is: 'my-tokensform',
            properties: {
                params_need: {
                    type: String,
                    value: ""
                },
                value_param: {
                    type: String,
                    value: ""
                },
                prop_comp: {
                    type: String,
                    value: ""
                },
                prop_object: {
                    type: Object,
                    value: function () { return {} }
                },
                getName: {
                    type: Array,
                    value: function () { return []; }
                },
                visible: {
                    type: Boolean,
                    value: false
                }
            },
            _showproperties: function (name, data) {
                this.visible = true;
                this.getName = data.name;
                var attributes = data.data[0].attributes;
                this.getAttr = Object.keys(attributes).map(function (key) {
                    return {
                        name: key,
                        value: attributes[key]
                    }
                });
                //borrar inputs del "formulario"
                this.querySelectorAll('#input-container input').forEach(function(el){el.value=null})
            },
            _sendForm: function (evt) {
                //Habra que comprobar si haciendo una peticion sale bien
                //Habra que hacer que se muestre la calidad ( entre los {} habra que meter los datos necesarios)
                this.fire("my-form-click", {});
            },
            _miFunction: function (evt) {
                var item = evt.model.item;
                this.set('prop_object.' + item.name, evt.currentTarget.value);
                console.log(this.prop_object);
            },
            _analize: function (evt) {
                //comprobar que se envian todos los atributos necesarios. TRATAMIENTO DE ERRORES
                this.$.send_attr.generateRequest();
                this.set('prop_object', {});
            }
        });
    </script>
</dom-module>